CREATE DATABASE CURSORES;
USE CURSORES;

    
CREATE TABLE VENDEDORES(
	IDVENDEDOR INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(50),
	JAN INT,
	FEV INT,
	MAR INT
);

    # INSERINDO ARQUIVOS PARA VISUALIZACAO

INSERT INTO VENDEDORES VALUES (NULL,'YURI',4123,41244,51365);
INSERT INTO VENDEDORES VALUES (NULL,'ALINE',515435,7345,173154);
INSERT INTO VENDEDORES VALUES (NULL,'LAURA',742565,234516,23455);
INSERT INTO VENDEDORES VALUES (NULL,'ISIS',74245,77475,72455);
INSERT INTO VENDEDORES VALUES (NULL,'VITORIA',5435,73436,72454);
INSERT INTO VENDEDORES VALUES (NULL,'MORAES',735245,28456,7454);
INSERT INTO VENDEDORES VALUES (NULL,'MOREIRA',72564,45326,536256);
INSERT INTO VENDEDORES VALUES (NULL,'CARVALHO',724564,7245,54545);

    ## CONFERINDO VALORES INSERIDOS
    
SELECT * FROM VENDEDORES;

SELECT NOME,(JAN+FEV+MAR) AS TOTAL FROM VENDEDORES;       # EXEMPLO DE EXIBICAO DE INFORMACOES

SELECT NOME,(JAN+FEV+MAR) AS TOTAL, TRUNCATE ((JAN+FEV+MAR)/3,2) AS MEDIA     
FROM VENDEDORES;                                          # EXEMPLO DE EXIBICAO DE INFORMACOES COM OPERACOES


    #TABELA ONDE SERA ADICIONADO AS INFORMACOES DE VENDEDORES E SUAS VENDAS
    
CREATE TABLE VEND_TOTAL(
	NOME VARCHAR(50),
	JAN INT,
	FEV INT,
	MAR INT,
	TOTAL INT,
	MEDIA INT
);

     	/* USANDO CURSOR/VETOR PARA ADICIONAR INFORMACOES A OUTRA TABELA DE FORMA AUTOMATICA 
            **** O CURSOR E UMA PROGRAMACAO DENTRO DE UMA PROCEDURE */

DELIMITER $

CREATE PROCEDURE INSEREDADOS()
BEGIN
        # DECLARANDO VARIAVEIS, UMA DECLARACAO PARA CADA TIPO DE VARIAVEL, INT - VARCHAR - ETC...
	DECLARE FIM INT DEFAULT 0;    # DECLARACAO INICIAL DO LOOP
	DECLARE VAR1, VAR2, VAR3, VTOTAL, VMEDIA INT;   # DECLARACAO DE INT
	DECLARE VNOME VARCHAR(50);    #DECLARACAO DE VARCHAR

	DECLARE REG CURSOR FOR(       # DECLARANDO A VARIAVEL DO CURSOR 
		SELECT NOME, JAN, FEV, MAR FROM VENDEDORES    # ESSA QUERRY VAI ALIMENTAR A VARIAVEL 'REG' QUE E DO TIPO CURSOR 
	);

    	# QUANDO NAO TIVER MAIS INFORMACAO PARA ADICIONAR,PARA O LOOP
    	# ESSE COMANDO SE REPETE EM QUALQUER CURSOR QUE FIZER
  
	DECLARE CONTINUE HANDLER FOR NOT FOUND SET FIM = 1;

	    # JOGA O VETOR PARA A MEMORIA RAM PARA PODER ALTERAR ELE 
      
	OPEN REG;

	REPEAT

		FETCH REG INTO VNOME, VAR1, VAR2, VAR3;
		IF NOT FIM THEN

			SET VTOTAL = VAR1 + VAR2 + VAR3;
			SET VMEDIA = VTOTAL / 3;

			INSERT INTO VEND_TOTAL VALUES (VNOME, VAR1, VAR2,
			VAR3, VTOTAL, VMEDIA);

		END IF;

	ULTIL FIM END REPEAT;	

    # LIMPAR MEMORIA RAM
	CLOSE REG;

END
$

DELIMITER ;





    ### MESMO CODIGO ANTERIOR SEM OBSERVACOES   ###


DELIMITER $

CREATE PROCEDURE INSEREDADOS()
BEGIN
	DECLARE FIM INT DEFAULT 0;
	DECLARE VAR1, VAR2, VAR3, VTOTAL, VMEDIA INT;
	DECLARE VNOME VARCHAR(50);

	DECLARE REG CURSOR FOR(
		SELECT NOME, JAN, FEV, MAR FROM VENDEDORES
	);

	
	DECLARE CONTINUE HANDLER FOR NOT FOUND SET FIM = 1;


	OPEN REG;

	REPEAT

		FETCH REG INTO VNOME, VAR1, VAR2, VAR3;
		IF NOT FIM THEN

			SET VTOTAL = VAR1 + VAR2 + VAR3;
			SET VMEDIA = VTOTAL / 3;

			INSERT INTO VEND_TOTAL VALUES (VNOME, VAR1, VAR2,
			VAR3, VTOTAL, VMEDIA);

		END IF;

	UNTIL FIM END REPEAT;	

	
	CLOSE REG;

END
$

DELIMITER ;



    # PARA EXECUTAR O CURSOR SE USA O COMANDO CALL NOME_CURSOR();

CALL INSEREDADOS();


    # APOS FAZER UM SELECT PARA CHECAR INFORMACOES ADICIONADAS A TABELA
    
    
mysql> SELECT * FROM VEND_TOTAL;
+----------+--------+--------+--------+---------+--------+
| NOME     | JAN    | FEV    | MAR    | TOTAL   | MEDIA  |
+----------+--------+--------+--------+---------+--------+
| YURI     |   4123 |  41244 |  51365 |   96732 |  32244 |
| ALINE    | 515435 |   7345 | 173154 |  695934 | 231978 |
| LAURA    | 742565 | 234516 |  23455 | 1000536 | 333512 |
| ISIS     |  74245 |  77475 |  72455 |  224175 |  74725 |
| VITORIA  |   5435 |  73436 |  72454 |  151325 |  50442 |
| MORAES   | 735245 |  28456 |   7454 |  771155 | 257052 |
| MOREIRA  |  72564 |  45326 | 536256 |  654146 | 218049 |
| CARVALHO | 724564 |   7245 |  54545 |  786354 | 262118 |
+----------+--------+--------+--------+---------+--------+
8 rows in set (0,01 sec)

